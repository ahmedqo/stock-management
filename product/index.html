<html>
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0"
		/>
		<link rel="stylesheet" href="../styles/GO.1.0.css" />
		<link rel="stylesheet" href="../styles/GOfont/style.css" />
		<title>Products | GALINI</title>
	</head>
	<body>
		<div id="head"></div>
		<div class="block justify-content-end">
			<div class="col-max hidden-sm hidden-md">
				<ul class="list">
					<li class="list-item">
						<a href="#" class="link">
							<span class="icon icon-lg icon-blank">
							</span>
						</a>
					</li>
				</ul>
			</div>
			<div class="col">
				<div class="col-12">
					<div
						id="list"
						class="block align-items-center justify-content-between"
					>
						<div class="col-max">
							<h1 class="title-three">
								<i
									class="GO-list"
									style="font-size: 32px;"
								></i>
								Liste Produit
							</h1>
						</div>
						<div class="col-max">
							<a
								id="showAdd"
								class="icon icon-lg icon-primary"
							>
								<i class="GO-plus"></i>
							</a>
						</div>
						<div class="break-five"></div>
						<form id="searchForm" class="block">
							<div class="col">
								<input
									id="searchBox"
									name="searchBox"
									type="search"
									class="formbox formbox-lg horizontal-fluid margin-bottom-six"
									placeholder="Recherche...."
								/>
							</div>
							<div class="col-max">
								<a
									onclick="getAll(undefined,'1')"
									class="icon icon-lg icon-success"
								>
									<i class="GO-checkbox"></i>
								</a>
							</div>
							<div class="col-max">
								<a
									onclick="getAll(undefined,'0')"
									class="icon icon-lg icon-danger"
								>
									<i class="GO-ban"></i>
								</a>
							</div>
						</form>
						<div class="col-12">
							<table
								class="table table-primary horizontal-fluid txt-center"
							>
								<thead>
									<tr>
										<td colspan="2">Produit</td>
										<td>Prix</td>
										<td>Statuts</td>
										<td>Options</td>
									</tr>
								</thead>
								<tbody id="searchResult">
									<tr>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
									</tr>
									<tr>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
									</tr>
									<tr>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
									</tr>
									<tr>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
									</tr>
									<tr>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
									</tr>
									<tr>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					<div
						id="add"
						class="block align-items-center justify-content-between"
					>
						<div class="col-max">
							<h1 class="title-three">
								<i
									class="GO-plus-square"
									style="font-size: 32px;"
								></i>
								Nouveau Produit
							</h1>
						</div>
						<div class="col-max">
							<a
								id="hideAdd"
								class="icon icon-lg icon-danger"
							>
								<i class="GO-times"></i>
							</a>
						</div>
						<div class="break-five"></div>
						<form
							id="addForm"
							class="block justify-content-end"
						>
							<div class="col-12">
								<h1 class="title-five">
									Image
								</h1>
							</div>
							<div class="col-12">
								<input
									type="text"
									id="imageAdd"
									name="imageAdd"
									class="formbox formbox-lg horizontal-fluid"
									placeholder="Image"
								/>
							</div>
							<div class="col-12">
								<h1 class="title-five">
									Titre
								</h1>
							</div>
							<div class="col-12">
								<input
									type="text"
									id="titleAdd"
									name="titleAdd"
									class="formbox formbox-lg horizontal-fluid"
									placeholder="Titre"
								/>
							</div>
							<div class="col-12">
								<h1 class="title-five">
									Prix
								</h1>
							</div>
							<div class="col-12">
								<input
									type="number"
									id="priceAdd"
									name="priceAdd"
									class="formbox formbox-lg horizontal-fluid"
									placeholder="Prix"
								/>
							</div>
							<div class="col-12">
								<h1 class="title-five">
									Quantite
								</h1>
							</div>
							<div class="col-12">
								<input
									type="number"
									id="quantityAdd"
									name="quantityAdd"
									class="formbox formbox-lg horizontal-fluid"
									placeholder="Quantite"
								/>
							</div>
							<div class="col-12">
								<h1 class="title-five">
									Marque
								</h1>
							</div>
							<div class="col-12">
								<select
									id="brandAdd"
									name="brandAdd"
									class="formbox formbox-lg horizontal-fluid"
								>
									<option selected disabled>
										Marque
									</option>
								</select>
							</div>
							<div class="col-12">
								<h1 class="title-five">
									Categorie
								</h1>
							</div>
							<div class="col-12">
								<select
									id="categoryAdd"
									name="categoryAdd"
									class="formbox formbox-lg horizontal-fluid"
								>
									<option selected disabled>
										Categorie
									</option>
								</select>
							</div>
							<div class="col-12">
								<button
									type="submit"
									class="btn btn-lg btn-primary horizontal-fluid"
								>
									Ajouter
								</button>
							</div>
						</form>
					</div>
					<div
						id="edit"
						class="block align-items-center justify-content-between"
					>
						<div class="col-max">
							<h1 class="title-three">
								<i
									class="GO-cog"
									style="font-size: 32px;"
								></i>
								Editer Produit
							</h1>
						</div>
						<div class="col-max">
							<a
								id="hideEdit"
								class="icon icon-lg icon-danger"
							>
								<i class="GO-times"></i>
							</a>
						</div>
						<div class="break-five"></div>
						<form
							id="editForm"
							class="block justify-content-end"
						>
							<input
								type="hidden"
								name="idEdit"
								id="idEdit"
							/>
							<div class="col-12">
								<h1 class="title-five">
									Image
								</h1>
							</div>
							<div class="col-12">
								<input
									type="text"
									id="imageEdit"
									name="imageEdit"
									class="formbox formbox-lg horizontal-fluid"
									placeholder="Image"
								/>
							</div>
							<div class="col-12">
								<h1 class="title-five">
									Titre
								</h1>
							</div>
							<div class="col-12">
								<input
									type="text"
									id="titleEdit"
									name="titleEdit"
									class="formbox formbox-lg horizontal-fluid"
									placeholder="Titre"
								/>
							</div>
							<div class="col-12">
								<h1 class="title-five">
									Prix
								</h1>
							</div>
							<div class="col-12">
								<input
									type="text"
									id="priceEdit"
									name="priceEdit"
									class="formbox formbox-lg horizontal-fluid"
									placeholder="Prix"
								/>
							</div>
							<div class="col-12">
								<h1 class="title-five">
									Quantite
								</h1>
							</div>
							<div class="col-12">
								<input
									type="number"
									id="quantityEdit"
									name="quantityEdit"
									class="formbox formbox-lg horizontal-fluid"
									placeholder="Quantite"
								/>
							</div>
							<div class="col-12">
								<h1 class="title-five">
									Marque
								</h1>
							</div>
							<div class="col-12">
								<select
									id="brandEdit"
									name="brandEdit"
									class="formbox formbox-lg horizontal-fluid"
								>
								</select>
							</div>
							<div class="col-12">
								<h1 class="title-five">
									Categorie
								</h1>
							</div>
							<div class="col-12">
								<select
									id="categoryEdit"
									name="categoryEdit"
									class="formbox formbox-lg horizontal-fluid"
								>
								</select>
							</div>
							<div class="col-12">
								<button
									type="submit"
									class="btn btn-lg btn-primary horizontal-fluid"
								>
									Enregister
								</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<script src="../scripts/GO.1.0.js"></script>
		<script src="../scripts/CODE.0.0.js"></script>
		<script src="../scripts/CODE.0.1.js"></script>
		<script>
			let Row = function (id, name, image, price, status) {
				let Class = (icon = "");
				if (parseInt(status)) {
					status = "Disponible";
					Class = "tag-success";
					icon = "GO-ban";
				} else {
					status = "Non Disponible";
					Class = "tag-danger";
					icon = "GO-checkbox";
				}
				return `<tr>
							<td>
								<img
									src="../assets/image/${image}"
									style="width: 50px;height: 50px;"
								/>
							</td>
							<td data-title="Produit">${name}</td>
							<td data-title="Prix">${price} MAD</td>
							<td data-title="Status">
								<span class="tag ${Class}">
									${status}
								</span>
							</td>
							<td data-title="Options">
								<a
									id="${id}"
									onclick="showEdit(this)"
									class="icon icon-sm icon-bold"
								>
									<i class="GO-edit"></i>
								</a>
								<a
									id="${id}"
									onclick="changeStatus(this)"
									class="icon icon-sm icon-bold"
								>
									<i
										class="${icon}"
									></i>
								</a>
							</td>
						</tr>`;
			};
			let getAll = function (search, status) {
				if (search === undefined) {
					search = "";
				}
				if (status === undefined) {
					status = "";
				}
				GO.ajax({
					url: "../libs/getProducts.php",
					method: "POST",
					data: {
						search: search,
						status: status,
					},
					success: function (data) {
						data = JSON.parse(data);
						if (data["type"] === "Error") {
							console.error("Get Products: Error");
						} else {
							console.info("Get Products: Success");
							GO("#searchResult").html("");
							if (data["message"] === true) {
								GO("#searchResult").append(
									`<tr><td colspan="5">Aucun Data Trouve</td></tr>`
								);
							} else {
								Array.from(data["message"]).forEach(
									(r) => {
										if (r[5] === "0") {
											Qteproduct(r[0]);
										}
										let row = Row(
											r[0],
											r[1],
											r[2],
											r[6],
											r[7]
										);
										GO("#searchResult").append(
											row
										);
									}
								);
							}
						}
					},
				});
			};
			let Qteproduct = function (id) {
				GO.ajax({
					url: "../libs/statusProduct.php",
					method: "POST",
					data: {
						id: id,
						status: 0,
					},
				});
			};
			let changeStatus = function (e) {
				let id = GO(e).attr("id");
				let status = GO(e).find("i").attr("class");
				if (status === "GO-ban") {
					status = 0;
				} else {
					status = 1;
				}
				GO.ajax({
					url: "../libs/statusProduct.php",
					method: "POST",
					data: {
						id: id,
						status: status,
					},
					success: function (data) {
						data = JSON.parse(data);
						if (data["type"] === "Error") {
							console.error("Status Product: Error");
							GO(".alert").removeClass("alert-success");
							GO(".alert").addClass("alert-danger");
							GO(".alert").find("p").html(data["message"]);
							GO(".alert").parent().css({ display: "" });
						} else {
							console.info("Status Product: Success");
							GO(".alert").removeClass("alert-danger");
							GO(".alert").addClass("alert-success");
							GO(".alert").find("p").html(data["message"]);
							GO(".alert").parent().css({ display: "" });
							getAll();
						}
					},
				});
			};
			let brands = function (target) {
				GO.ajax({
					url: "../libs/getBrands.php",
					method: "POST",
					success: function (data) {
						data = JSON.parse(data);
						if (data["type"] === "Error") {
							console.error("Get Brands: Error");
						} else {
							console.info("Get Brands: Success");
							Array.from(data["message"]).forEach((b) => {
								if (parseInt(b[2]) === 1) {
									GO(target).append(
										`<option value="${b[0]}">${b[1]}</option>`
									);
								}
							});
						}
					},
				});
			};
			let categories = function (target) {
				GO.ajax({
					url: "../libs/getCategories.php",
					method: "POST",
					success: function (data) {
						data = JSON.parse(data);
						if (data["type"] === "Error") {
							console.error("Get Categories: Error");
						} else {
							console.info("Get Categories: Success");
							Array.from(data["message"]).forEach((b) => {
								if (parseInt(b[2]) === 1) {
									GO(target).append(
										`<option value="${b[0]}">${b[1]}</option>`
									);
								}
							});
						}
					},
				});
			};
			let showEdit = function (e) {
				let id = GO(e).attr("id");
				GO.ajax({
					url: "../libs/getProduct.php",
					method: "POST",
					data: { id: id },
					success: function (data) {
						data = JSON.parse(data);
						if (data["type"] === "Error") {
							console.error("Get Product: Error");
						} else {
							console.info("Get Product: Success");
							GO("#idEdit").val(data["message"][0]);
							GO("#imageEdit")
								.next()
								.next()
								.html(
									`<img src="../assets/image/${data["message"][2]}">`
								);
							GO("#titleEdit").val(data["message"][1]);
							GO("#priceEdit").val(data["message"][6]);
							GO("#quantityEdit").val(data["message"][5]);
							let brand = document.getElementById(
								"brandEdit"
							).options;
							Array.from(brand).forEach((b) => {
								if (b.value === data["message"][3]) {
									b.selected = "selected";
								}
							});
							let category = document.getElementById(
								"categoryEdit"
							).options;
							Array.from(category).forEach((c) => {
								if (c.value === data["message"][3]) {
									c.selected = "selected";
								}
							});
							GO("#list").css({ display: "none" });
							GO("#edit").css({ display: "" });
						}
					},
				});
			};
			window.onload = function () {
				getAll();
				brands("#brandAdd");
				categories("#categoryAdd");
				brands("#brandEdit");
				categories("#categoryEdit");
				GO.uploadBox({
					selector: "#imageAdd",
					type: "horizontal-fluid",
				});
				GO.uploadBox({
					selector: "#imageEdit",
					type: "horizontal-fluid",
				});
			};
			GO("#head").include("../head.html");
			GO("#searchBox").on("keyup", function () {
				getAll(GO(this).val(), undefined);
			});
			GO("#editForm").submit(function (e) {
				e.preventDefault();
				let proceed = false;
				if (GO("#titleEdit").val()) {
					GO("#titleEdit").css({ "border-color": "" });
				} else {
					GO("#titleEdit").css({ "border-color": "red" });
					proceed = true;
				}
				if (GO("#priceEdit").val()) {
					GO("#priceEdit").css({ "border-color": "" });
				} else {
					GO("#priceEdit").css({ "border-color": "red" });
					proceed = true;
				}
				if (GO("#quantityEdit").val()) {
					GO("#quantityEdit").css({ "border-color": "" });
				} else {
					GO("#quantityEdit").css({ "border-color": "red" });
					proceed = true;
				}
				if (proceed) {
					GO(".alert").removeClass("alert-success");
					GO(".alert").addClass("alert-danger");
					GO(".alert").find("p").html("All Fields Are Required");
					GO(".alert").parent().css({ display: "" });
					return;
				}
				GO.ajax({
					url: "../libs/resetProduct.php",
					method: "POST",
					data: new FormData(
						document.getElementById("editForm")
					),
					success: function (data) {
						data = JSON.parse(data);
						if (data["type"] === "Error") {
							console.error("New Product: Error");
							GO(".alert").removeClass("alert-success");
							GO(".alert").addClass("alert-danger");
							GO(".alert").find("p").html(data["message"]);
							GO(".alert").parent().css({ display: "" });
						} else {
							console.info("New Product: Success");
							GO(".alert").removeClass("alert-danger");
							GO(".alert").addClass("alert-success");
							GO(".alert").find("p").html(data["message"]);
							GO(".alert").parent().css({ display: "" });
							getAll();
						}
					},
				});
			});
			GO("#addForm").submit(function (e) {
				e.preventDefault();
				let proceed = false;
				if (GO("#imageAdd").val()) {
					GO("#imageAdd").parent().css({ "border-color": "" });
				} else {
					GO("#imageAdd")
						.parent()
						.css({ "border-color": "red" });
					proceed = true;
				}
				if (GO("#titleAdd").val()) {
					GO("#titleAdd").css({ "border-color": "" });
				} else {
					GO("#titleAdd").css({ "border-color": "red" });
					proceed = true;
				}
				if (GO("#priceAdd").val()) {
					GO("#priceAdd").css({ "border-color": "" });
				} else {
					GO("#priceAdd").css({ "border-color": "red" });
					proceed = true;
				}
				if (GO("#quantityAdd").val()) {
					GO("#quantityAdd").css({ "border-color": "" });
				} else {
					GO("#quantityAdd").css({ "border-color": "red" });
					proceed = true;
				}
				if (GO("#brandAdd").val()) {
					GO("#brandAdd").css({ "border-color": "" });
				} else {
					GO("#brandAdd").css({ "border-color": "red" });
					proceed = true;
				}
				if (GO("#categoryAdd").val()) {
					GO("#categoryAdd").css({ "border-color": "" });
				} else {
					GO("#categoryAdd").css({ "border-color": "red" });
					proceed = true;
				}
				if (proceed) {
					GO(".alert").removeClass("alert-success");
					GO(".alert").addClass("alert-danger");
					GO(".alert").find("p").html("All Fields Are Required");
					GO(".alert").parent().css({ display: "" });
					return;
				}
				GO.ajax({
					url: "../libs/setProduct.php",
					method: "POST",
					data: new FormData(document.getElementById("addForm")),
					success: function (data) {
						data = JSON.parse(data);
						if (data["type"] === "Error") {
							console.error("New Product: Error");
							GO(".alert").removeClass("alert-success");
							GO(".alert").addClass("alert-danger");
							GO(".alert").find("p").html(data["message"]);
							GO(".alert").parent().css({ display: "" });
						} else {
							console.info("New Product: Success");
							GO(".alert").removeClass("alert-danger");
							GO(".alert").addClass("alert-success");
							GO(".alert").find("p").html(data["message"]);
							GO(".alert").parent().css({ display: "" });
							getAll();
						}
					},
				});
			});
		</script>
	</body>
</html>
