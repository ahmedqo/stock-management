<html>
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0"
		/>
		<link rel="stylesheet" href="../styles/GO.1.0.css" />
		<link rel="stylesheet" href="../styles/GOfont/style.css" />
		<title>Categories | GALINI</title>
	</head>
	<body>
		<div id="head"></div>
		<div class="block justify-content-end">
			<div class="col-max hidden-sm hidden-md">
				<ul class="list">
					<li class="list-item">
						<a href="#" class="link">
							<span class="icon icon-lg icon-blank">
							</span>
						</a>
					</li>
				</ul>
			</div>
			<div class="col">
				<div class="col-12">
					<div
						id="list"
						class="block align-items-center justify-content-between"
					>
						<div class="col-max">
							<h1 class="title-three">
								<i
									class="GO-list"
									style="font-size: 32px;"
								></i>
								Liste Categorie
							</h1>
						</div>
						<div class="col-max">
							<a
								id="showAdd"
								class="icon icon-lg icon-primary"
							>
								<i class="GO-plus"></i>
							</a>
						</div>
						<div class="break-five"></div>
						<form id="searchForm" class="block">
							<div class="col">
								<input
									id="searchBox"
									name="searchBox"
									type="search"
									class="formbox formbox-lg horizontal-fluid margin-bottom-six"
									placeholder="Recherche...."
								/>
							</div>
							<div class="col-max">
								<a
									onclick="getAll(undefined,'1')"
									class="icon icon-lg icon-success"
								>
									<i class="GO-checkbox"></i>
								</a>
							</div>
							<div class="col-max">
								<a
									onclick="getAll(undefined,'0')"
									class="icon icon-lg icon-danger"
								>
									<i class="GO-ban"></i>
								</a>
							</div>
						</form>
						<div class="col-12">
							<table
								class="table table-primary horizontal-fluid txt-center"
							>
								<thead>
									<tr>
										<td>Nom Categorie</td>
										<td>Statuts</td>
										<td>Options</td>
									</tr>
								</thead>
								<tbody id="searchResult">
									<tr>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
									</tr>
									<tr>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
									</tr>
									<tr>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
									</tr>
									<tr>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
									</tr>
									<tr>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
									</tr>
									<tr>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
										<td>
											<div
												class="col-12 loader padding-five"
											></div>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					<div
						id="add"
						class="block align-items-center justify-content-between"
					>
						<div class="col-max">
							<h1 class="title-three">
								<i
									class="GO-plus-square"
									style="font-size: 32px;"
								></i>
								Nouveau Categorie
							</h1>
						</div>
						<div class="col-max">
							<a
								id="hideAdd"
								class="icon icon-lg icon-danger"
							>
								<i class="GO-times"></i>
							</a>
						</div>
						<div class="break-five"></div>
						<form
							id="addForm"
							class="block justify-content-end"
						>
							<div class="col-12">
								<h1 class="title-five">
									Nom Categorie
								</h1>
							</div>
							<div class="col-12">
								<input
									type="text"
									id="nameAdd"
									name="nameAdd"
									class="formbox formbox-lg horizontal-fluid"
									placeholder="Nom Categorie"
								/>
							</div>
							<div class="col-12">
								<button
									type="submit"
									class="btn btn-lg btn-primary horizontal-fluid"
								>
									Ajouter
								</button>
							</div>
						</form>
					</div>
					<div
						id="edit"
						class="block align-items-center justify-content-between"
					>
						<div class="col-max">
							<h1 class="title-three">
								<i
									class="GO-cog"
									style="font-size: 32px;"
								></i>
								Editer Categorie
							</h1>
						</div>
						<div class="col-max">
							<a
								id="hideEdit"
								class="icon icon-lg icon-danger"
							>
								<i class="GO-times"></i>
							</a>
						</div>
						<div class="break-five"></div>
						<form
							id="editForm"
							class="block justify-content-end"
						>
							<input
								type="hidden"
								id="idEdit"
								name="idEdit"
							/>
							<div class="col-12">
								<h1 class="title-five">
									Nom Categorie
								</h1>
							</div>
							<div class="col-12">
								<input
									type="text"
									id="nameEdit"
									name="nameEdit"
									class="formbox formbox-lg horizontal-fluid"
									placeholder="Nom Categorie"
								/>
							</div>
							<div class="col-12">
								<button
									type="submit"
									class="btn btn-lg btn-primary horizontal-fluid"
								>
									Enregister
								</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<script src="../scripts/GO.1.0.js"></script>
		<script src="../scripts/CODE.0.0.js"></script>
		<script src="../scripts/CODE.0.1.js"></script>
		<script>
			let Row = function (id, name, status) {
				let Class = (icon = "");
				if (parseInt(status)) {
					status = "Disponible";
					Class = "tag-success";
					icon = "GO-ban";
				} else {
					status = "Non Disponible";
					Class = "tag-danger";
					icon = "GO-checkbox";
				}
				return `<tr>
							<td data-title="Nom Marque">
								${name}
							</td>
							<td data-title="Statuts">
								<span
									class="tag ${Class}"
								>
									${status}
								</span>
							</td>
							<td data-title="Options">
								<a
									id="${id}"
									onclick="showEdit(this)"
									class="icon icon-sm icon-bold"
								>
									<i
										class="GO-edit"
									></i>
								</a>
								<a
									id="${id}"
									onclick="changeStatus(this)"
									class="icon icon-sm icon-bold"
								>
									<i
										class="${icon}"
									></i>
								</a>
							</td>
						</tr>`;
			};
			let getAll = function (search, status) {
				if (search === undefined) {
					search = "";
				}
				if (status === undefined) {
					status = "";
				}
				GO.ajax({
					url: "../libs/getCategories.php",
					method: "POST",
					data: {
						search: search,
						status: status,
					},
					success: function (data) {
						data = JSON.parse(data);
						if (data["type"] === "Error") {
							console.error("Get Categories: Error");
						} else {
							console.info("Get Categories: Success");
							GO("#searchResult").html("");
							if (data["message"] === true) {
								GO("#searchResult").append(
									`<tr><td colspan="3">Aucun Data Trouve</td></tr>`
								);
							} else {
								data["message"].forEach((r) => {
									let row = Row(r[0], r[1], r[2]);
									GO("#searchResult").append(row);
								});
							}
						}
					},
				});
			};
			let showEdit = function (e) {
				let id = GO(e).attr("id");
				GO.ajax({
					url: "../libs/getCategory.php",
					method: "POST",
					data: { id: id },
					success: function (data) {
						data = JSON.parse(data);
						if (data["type"] === "Error") {
							console.error("Get Category: Error");
						} else {
							console.info("Get Category: Success");
							GO("#idEdit").val(data["message"][0]);
							GO("#nameEdit").val(data["message"][1]);
							GO("#list").css({ display: "none" });
							GO("#edit").css({ display: "" });
						}
					},
				});
			};
			let changeStatus = function (e) {
				let id = GO(e).attr("id");
				let status = GO(e).parent().prev().text();
				if (status === "Disponible") {
					status = 0;
				} else {
					status = 1;
				}
				GO.ajax({
					url: "../libs/statusCategory.php",
					method: "POST",
					data: {
						id: id,
						status: status,
					},
					success: function (data) {
						data = JSON.parse(data);
						if (data["type"] === "Error") {
							console.error("Status Category: Error");
							GO(".alert").removeClass("alert-success");
							GO(".alert").addClass("alert-danger");
							GO(".alert").find("p").html(data["message"]);
							GO(".alert").parent().css({ display: "" });
						} else {
							console.info("Status Category: Success");
							GO(".alert").removeClass("alert-danger");
							GO(".alert").addClass("alert-success");
							GO(".alert").find("p").html(data["message"]);
							GO(".alert").parent().css({ display: "" });
							getAll();
						}
					},
				});
			};

			window.onload = function () {
				getAll();
			};
			GO("#head").include("../head.html");
			GO("#searchBox").on("keyup", function () {
				getAll(GO(this).val(), undefined);
			});
			GO("#editForm").submit(function (e) {
				e.preventDefault();
				if (GO("#nameEdit").val()) {
					GO("#nameEdit").css({ "border-color": "" });
				} else {
					GO("#nameEdit").css({ "border-color": "red" });
					GO(".alert").removeClass("alert-success");
					GO(".alert").addClass("alert-danger");
					GO(".alert").find("p").html("All Fields Are Required");
					GO(".alert").parent().css({ display: "" });
					return;
				}
				GO.ajax({
					url: "../libs/resetCategory.php",
					method: "POST",
					data: new FormData(
						document.getElementById("editForm")
					),
					success: function (data) {
						data = JSON.parse(data);
						if (data["type"] === "Error") {
							console.error("Edit Category: Error");
							GO(".alert").removeClass("alert-success");
							GO(".alert").addClass("alert-danger");
							GO(".alert").find("p").html(data["message"]);
							GO(".alert").parent().css({ display: "" });
						} else {
							console.info("Edit Category: Success");
							GO(".alert").removeClass("alert-danger");
							GO(".alert").addClass("alert-success");
							GO(".alert").find("p").html(data["message"]);
							GO(".alert").parent().css({ display: "" });
							getAll();
						}
					},
				});
			});
			GO("#addForm").submit(function (e) {
				e.preventDefault();
				if (GO("#nameAdd").val()) {
					GO("#nameAdd").css({ "border-color": "" });
				} else {
					GO("#nameAdd").css({ "border-color": "red" });
					GO(".alert").removeClass("alert-success");
					GO(".alert").addClass("alert-danger");
					GO(".alert").find("p").html("All Fields Are Required");
					GO(".alert").parent().css({ display: "" });
					return;
				}
				GO.ajax({
					url: "../libs/setCategory.php",
					method: "POST",
					data: new FormData(document.getElementById("addForm")),
					success: function (data) {
						data = JSON.parse(data);
						if (data["type"] === "Error") {
							console.error("New Category: Error");
							GO(".alert").removeClass("alert-success");
							GO(".alert").addClass("alert-danger");
							GO(".alert").find("p").html(data["message"]);
							GO(".alert").parent().css({ display: "" });
						} else {
							console.info("New Category: Success");
							GO(".alert").removeClass("alert-danger");
							GO(".alert").addClass("alert-success");
							GO(".alert").find("p").html(data["message"]);
							GO(".alert").parent().css({ display: "" });
							getAll();
						}
					},
				});
			});
		</script>
	</body>
</html>
